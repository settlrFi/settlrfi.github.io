---
// EquityFlowDarkAnimated.astro
---

<div class="relative w-full max-w-5xl mx-auto rounded-3xl overflow-hidden border border-emerald-500/30 shadow-[0_0_50px_rgba(16,185,129,0.15)] bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 group">
  
  {/* Sfondo Griglia Animata */}
  <div class="absolute inset-0 z-0 opacity-20 pointer-events-none" style="background-image: radial-gradient(#10b981 1px, transparent 1px); background-size: 30px 30px; animation: panGrid 20s linear infinite;"></div>

  {/* Contenitore SVG */}
  <div class="relative z-10 w-full aspect-[16/11] min-h-[600px]">
    <svg viewBox="0 0 1100 650" class="w-full h-full drop-shadow-2xl" preserveAspectRatio="xMidYMid meet">
      
      <defs>
        <style>
          @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700;800&display=swap');
          .tech-font { font-family: 'Space Grotesk', system-ui, sans-serif; }
          
          /* Animazione per i percorsi tratteggiati */
          @keyframes dashMove { to { stroke-dashoffset: -20; } }
          .animated-path { stroke-dasharray: 8 6; animation: dashMove 1s linear infinite; }
          
          /* Effetto Hub centrale */
          @keyframes pulseCore {
            0% { r: 35; opacity: 0.8; }
            50% { r: 45; opacity: 0.2; }
            100% { r: 35; opacity: 0.8; }
          }
        </style>

        {/* Frecce (Markers) */}
        <marker id="arrowEmerald" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#34d399" />
        </marker>
        <marker id="arrowBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#60a5fa" />
        </marker>
        <marker id="arrowPink" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#f472b6" />
        </marker>
        <marker id="arrowRed" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#ef4444" />
        </marker>

        {/* Glow Effects */}
        <filter id="glowHeavy" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
        <filter id="glowSubtle" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      {/* ================= TITOLO ================= */}
      <text x="40" y="60" fill="#e2e8f0" font-size="36" class="tech-font font-extrabold drop-shadow-lg">
        Equity Diagram
      </text>
      <text x="40" y="90" fill="#94a3b8" font-size="16" class="tech-font font-medium">
        Tokenization & Settlement Architecture
      </text>
      
      {/* T+0 Badge */}
      <g transform="translate(480, 45)">
        <rect x="0" y="0" width="160" height="30" rx="15" fill="#ef4444" fill-opacity="0.1" stroke="#ef4444" stroke-width="2"/>
        <text x="80" y="20" fill="#fca5a5" font-size="12" font-weight="bold" text-anchor="middle" class="tech-font tracking-widest uppercase">
          Potentially T+0
        </text>
      </g>

      {/* ================= ON CHAIN BOX ================= */}
      <rect x="360" y="160" width="680" height="450" rx="24" fill="#064e3b" fill-opacity="0.1" stroke="#34d399" stroke-width="2" stroke-dasharray="10 10" opacity="0.6"/>
      <text x="380" y="590" fill="#34d399" font-size="14" font-weight="900" class="tech-font tracking-widest opacity-80">ON CHAIN</text>


      {/* ================= PATHS (CONNESSIONI) ================= */}
      {/* Custodian <-> Issuers */}
      <path d="M 140 200 L 140 280" stroke="#475569" stroke-width="4" fill="none" class="animated-path"/>
      <path d="M 140 200 L 140 280" stroke="#34d399" stroke-width="2" fill="none" marker-end="url(#arrowEmerald)" marker-start="url(#arrowEmerald)" opacity="0.8"/>

      {/* Investor -> Issuers */}
      <path d="M 140 480 L 140 380" stroke="#475569" stroke-width="4" fill="none" class="animated-path"/>
      <path d="M 140 480 L 140 380" stroke="#f472b6" stroke-width="2" fill="none" marker-end="url(#arrowPink)" opacity="0.8"/>

      {/* Issuers -> Green Wallet */}
      <path d="M 220 330 L 410 330" stroke="#475569" stroke-width="4" fill="none" class="animated-path"/>
      <path d="M 220 330 L 410 330" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowBlue)" opacity="0.8"/>

      {/* Green Wallet -> Blockchain Core */}
      <path d="M 510 330 L 640 375" stroke="#475569" stroke-width="4" fill="none" class="animated-path"/>
      <path d="M 510 330 L 640 375" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowBlue)" opacity="0.8"/>

      {/* Red Wallet -> Blockchain Core */}
      <path d="M 510 490 L 640 425" stroke="#475569" stroke-width="4" fill="none" class="animated-path"/>
      <path d="M 510 490 L 640 425" stroke="#ef4444" stroke-width="2" fill="none" marker-end="url(#arrowRed)" opacity="0.8"/>

      {/* Oracles -> Blockchain Core */}
      <path d="M 910 240 Q 800 240 730 360" stroke="#475569" stroke-width="4" fill="none" class="animated-path"/>
      <path d="M 910 240 Q 800 240 730 360" stroke="#a78bfa" stroke-width="2" fill="none" marker-end="url(#arrowBlue)" opacity="0.8"/>

      {/* Blockchain Core -> Institutions */}
      <path d="M 740 420 Q 850 490 910 490" stroke="#475569" stroke-width="4" fill="none" class="animated-path"/>
      <path d="M 740 420 Q 850 490 910 490" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowBlue)" opacity="0.8"/>


      {/* ================= PARTICELLE ANIMATE SUI PATH ================= */}
      <circle r="5" fill="#34d399" filter="url(#glowSubtle)">
        <animateMotion dur="2s" repeatCount="indefinite" path="M 140 280 L 140 200" />
      </circle>
      <circle r="5" fill="#f472b6" filter="url(#glowSubtle)">
        <animateMotion dur="2.5s" repeatCount="indefinite" path="M 140 480 L 140 380" />
      </circle>
      <circle r="5" fill="#60a5fa" filter="url(#glowSubtle)">
        <animateMotion dur="2s" repeatCount="indefinite" path="M 220 330 L 410 330" />
      </circle>
      <circle r="5" fill="#60a5fa" filter="url(#glowSubtle)">
        <animateMotion dur="1.5s" repeatCount="indefinite" path="M 510 330 L 640 375" />
      </circle>
      <circle r="5" fill="#ef4444" filter="url(#glowSubtle)">
        <animateMotion dur="2s" repeatCount="indefinite" path="M 510 490 L 640 425" />
      </circle>


      {/* ================= ETICHETTE (ForeignObjects) ================= */}
      <foreignObject x="220" y="220" width="160" height="70" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/80 border border-emerald-500/40 rounded-xl px-3 py-2 shadow-lg backdrop-blur-md">
          <span class="text-slate-200 text-[10px] font-semibold leading-tight text-center">Custodian<br/>authorizes mint</span>
          <span class="text-emerald-400 font-black text-xs text-center mt-1">1:1 Backed</span>
        </div>
      </foreignObject>

      <foreignObject x="20" y="390" width="110" height="60" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/80 border border-slate-700 rounded-lg px-2 py-1.5 shadow-lg backdrop-blur-md text-center">
          <span class="text-slate-300 text-[9px] font-semibold leading-tight">Purchase actual shares<br/><span class="text-pink-400">Asks for minting</span></span>
        </div>
      </foreignObject>

      <foreignObject x="180" y="470" width="100" height="50" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/80 border border-slate-700 rounded-lg px-2 py-1.5 shadow-lg backdrop-blur-md text-center">
          <span class="text-slate-300 text-[9px] font-semibold leading-tight">KYC / AML<br/>Fiat Transfer</span>
        </div>
      </foreignObject>

      <foreignObject x="850" y="550" width="150" height="50" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/80 border border-blue-500/40 rounded-lg px-2 py-1.5 shadow-lg backdrop-blur-md text-center">
          <span class="text-blue-200 text-[10px] font-semibold leading-tight">All institutions look<br/>at the same truth</span>
        </div>
      </foreignObject>


      {/* ================= NODI PRINCIPALI ================= */}
      
      {/* 1. Custodian */}
      <g transform="translate(100, 120)">
        <g class="node-float">
          <text x="40" y="-15" text-anchor="middle" fill="#34d399" font-size="16" class="tech-font font-bold drop-shadow-md">Custodian</text>
          <polygon points="40,0 10,25 70,25" fill="#1e293b" stroke="#34d399" stroke-width="3" stroke-linejoin="round"/>
          <rect x="18" y="25" width="8" height="30" fill="none" stroke="#34d399" stroke-width="3"/>
          <rect x="36" y="25" width="8" height="30" fill="none" stroke="#34d399" stroke-width="3"/>
          <rect x="54" y="25" width="8" height="30" fill="none" stroke="#34d399" stroke-width="3"/>
          <rect x="10" y="55" width="60" height="10" fill="#1e293b" stroke="#34d399" stroke-width="3"/>
        </g>
      </g>

      {/* 2. Issuers */}
      <g transform="translate(100, 290)">
        <g class="node-float-delay">
          <text x="40" y="-15" text-anchor="middle" fill="#e2e8f0" font-size="16" class="tech-font font-bold drop-shadow-md">Issuers</text>
          <rect x="10" y="10" width="60" height="50" rx="8" fill="#1e293b" stroke="#cbd5e1" stroke-width="3"/>
          <rect x="20" y="20" width="15" height="15" fill="#334155"/>
          <rect x="45" y="20" width="15" height="15" fill="#334155"/>
          <rect x="20" y="45" width="40" height="15" fill="#334155"/>
          <circle cx="40" cy="5" r="8" fill="#1e293b" stroke="#cbd5e1" stroke-width="3"/>
        </g>
      </g>

      {/* 3. Investor */}
      <g transform="translate(100, 480)">
        <g class="node-float">
          <text x="40" y="-15" text-anchor="middle" fill="#f472b6" font-size="16" class="tech-font font-bold drop-shadow-md">Investor</text>
          <circle cx="40" cy="20" r="14" fill="none" stroke="#f472b6" stroke-width="3"/>
          <path d="M 15 60 C 15 40 65 40 65 60" fill="none" stroke="#f472b6" stroke-width="3" stroke-linecap="round"/>
          <circle cx="60" cy="50" r="12" fill="#1e293b" stroke="#f472b6" stroke-width="2"/>
          <path d="M 55 50 L 59 54 L 66 46" fill="none" stroke="#f472b6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </g>
      </g>

      {/* 4. Green Wallet */}
      <g transform="translate(420, 290)">
        <g class="node-float">
          <text x="40" y="-15" text-anchor="middle" fill="#60a5fa" font-size="14" class="tech-font font-bold">Investor's Wallet</text>
          <rect x="15" y="15" width="50" height="35" rx="6" fill="#1e293b" stroke="#60a5fa" stroke-width="3"/>
          <path d="M 15 25 L 65 25" stroke="#60a5fa" stroke-width="2"/>
          <circle cx="40" cy="35" r="4" fill="#60a5fa"/>
        </g>
      </g>

      {/* 5. Red Wallet */}
      <g transform="translate(420, 460)">
        <g class="node-float-delay">
          <text x="40" y="-15" text-anchor="middle" fill="#ef4444" font-size="14" class="tech-font font-bold">Other Wallets</text>
          <rect x="15" y="15" width="50" height="35" rx="6" fill="#1e293b" stroke="#ef4444" stroke-width="3"/>
          <path d="M 15 25 L 65 25" stroke="#ef4444" stroke-width="2"/>
          <circle cx="40" cy="35" r="4" fill="#ef4444"/>
        </g>
      </g>

      {/* 6. Blockchain Core */}
      <g transform="translate(680, 400)">
        <circle cx="0" cy="0" r="40" fill="#1e293b" stroke="#6366f1" stroke-width="2" filter="url(#glowHeavy)"/>
        <circle cx="0" cy="0" r="35" fill="none" stroke="#3b82f6" stroke-width="4" opacity="0.5">
          <animate style="animation: pulseCore 3s infinite" />
        </circle>
        
        {/* Core Icon */}
        <path d="M -15 -10 L 0 -20 L 15 -10 L 15 10 L 0 20 L -15 10 Z" fill="#0f172a" stroke="#60a5fa" stroke-width="2"/>
        <circle cx="0" cy="0" r="3" fill="#60a5fa">
          <animate attributeName="opacity" values="1;0;1" dur="1.5s" repeatCount="indefinite"/>
        </circle>
        <line x1="0" y1="0" x2="-15" y2="-10" stroke="#60a5fa" stroke-width="1.5"/>
        <line x1="0" y1="0" x2="15" y2="-10" stroke="#60a5fa" stroke-width="1.5"/>
        <line x1="0" y1="0" x2="0" y2="20" stroke="#60a5fa" stroke-width="1.5"/>
        <text x="0" y="55" text-anchor="middle" fill="#e2e8f0" font-size="16" class="tech-font font-extrabold" filter="url(#glowHeavy)">Blockchain Core</text>
      </g>

      {/* 7. Oracles */}
      <g transform="translate(900, 180)">
        <g class="node-float">
          <text x="35" y="-15" text-anchor="middle" fill="#a78bfa" font-size="16" class="tech-font font-bold drop-shadow-md">Oracles</text>
          <polygon points="35,0 70,30 35,60 0,30" fill="#1e293b" stroke="#a78bfa" stroke-width="3"/>
          <polygon points="35,15 50,30 35,45 20,30" fill="#8b5cf6" stroke="none" opacity="0.8">
            <animate attributeName="opacity" values="0.8;0.3;0.8" dur="2s" repeatCount="indefinite"/>
          </polygon>
        </g>
      </g>

      {/* 8. Institutions / Clearing House */}
      <g transform="translate(900, 460)">
        <g class="node-float-delay">
          <text x="40" y="-15" text-anchor="middle" fill="#60a5fa" font-size="16" class="tech-font font-bold drop-shadow-md">Institutions</text>
          <rect x="10" y="10" width="60" height="50" rx="4" fill="#1e293b" stroke="#60a5fa" stroke-width="3"/>
          <path d="M 20 25 L 30 25 M 50 25 L 60 25" stroke="#60a5fa" stroke-width="2" stroke-linecap="round"/>
          <circle cx="40" cy="25" r="6" fill="none" stroke="#60a5fa" stroke-width="2"/>
          <path d="M 20 45 L 60 45" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
          <circle cx="30" cy="45" r="2" fill="#0f172a"/>
          <circle cx="40" cy="45" r="2" fill="#0f172a"/>
          <circle cx="50" cy="45" r="2" fill="#0f172a"/>
        </g>
      </g>

    </svg>
  </div>
</div>

<style>
  /* Movimento della griglia di sfondo */
  @keyframes panGrid {
    0% { background-position: 0 0; }
    100% { background-position: 30px 30px; }
  }

  /* Effetto galleggiamento per i nodi */
  .node-float { animation: floatNode 6s ease-in-out infinite; }
  .node-float-delay { animation: floatNode 6s ease-in-out infinite 3s; }
  @keyframes floatNode {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
</style>