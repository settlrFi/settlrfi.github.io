---
// EquityFlowDarkAnimatedLarge.astro
---

<div class="relative w-full max-w-5xl mx-auto rounded-3xl overflow-hidden border border-emerald-500/30 shadow-[0_0_50px_rgba(16,185,129,0.15)] bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 group">
  
  {/* Sfondo Griglia Animata */}
  <div class="absolute inset-0 z-0 opacity-20 pointer-events-none" style="background-image: radial-gradient(#10b981 1px, transparent 1px); background-size: 30px 30px; animation: panGrid 20s linear infinite;"></div>

  {/* Contenitore SVG - ViewBox Ingrandita */}
  <div class="relative z-0 w-full aspect-[16/11] lg:min-h-[650px]">
    <svg viewBox="0 -50 1200 800" class="w-full h-full drop-shadow-2xl" preserveAspectRatio="xMidYMid meet">
      
      <defs>
        <style>
          @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700;800&display=swap');
          .tech-font { font-family: 'Space Grotesk', system-ui, sans-serif; }
          
          /* Animazione per i percorsi tratteggiati */
          @keyframes dashMove { to { stroke-dashoffset: -20; } }
          .animated-path { stroke-dasharray: 8 6; animation: dashMove 1s linear infinite; }
          
          /* Effetto Hub centrale */
          @keyframes pulseCore {
            0% { r: 45; opacity: 0.8; }
            50% { r: 55; opacity: 0.2; }
            100% { r: 45; opacity: 0.8; }
          }
        </style>

        {/* Frecce (Markers) */}
        <marker id="arrowEmerald" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#34d399" />
        </marker>
        <marker id="arrowBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#60a5fa" />
        </marker>
        <marker id="arrowPink" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#f472b6" />
        </marker>
        <marker id="arrowRed" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#ef4444" />
        </marker>

        {/* Glow Effects */}
        <filter id="glowHeavy" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="5" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
        <filter id="glowSubtle" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      {/* ================= TITOLO INGRANDITO ================= */}
      <text x="50" y="0" fill="#e2e8f0" font-size="46" class="tech-font font-extrabold drop-shadow-lg">
        Equity Diagram
      </text>
      <text x="50" y="35" fill="#94a3b8" font-size="24" class="tech-font font-medium">
        Tokenization & Settlement Architecture
      </text>
      
      {/* T+0 Badge */}
      <g transform="translate(600, 50)">
        <rect x="-30" y="-8" width="265" height="50" rx="25" fill="#4c0519" stroke="#f43f5e" stroke-width="2" filter="url(#glowHeavy)"/>
        <text x="100" y="26" fill="#fecdd3" font-size="28" font-weight="bold" text-anchor="middle" class="tech-font tracking-wide">
          <tspan fill="#f43f5e" font-size="32">âš </tspan> T+0 PROCESS
        </text>
      </g>


      {/* ================= ON CHAIN BOX ================= */}
      <rect x="360" y="160" width="800" height="600" rx="24" fill="#064e3b" fill-opacity="0.1" stroke="#34d399" stroke-width="3" stroke-dasharray="12 12" opacity="0.6"/>
      <text x="390" y="730" fill="#34d399" font-size="26" font-weight="900" class="tech-font tracking-widest opacity-80">ON CHAIN</text>


      {/* ================= PATHS (CONNESSIONI) RICALCOLATI ================= */}
      
      {/* Custodian <-> Issuers */}
      <path d="M 140 200 L 140 300" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 140 200 L 140 300" stroke="#34d399" stroke-width="3" fill="none" marker-end="url(#arrowEmerald)" marker-start="url(#arrowEmerald)" opacity="0.8"/>

      {/* Investor -> Issuers */}
      <path d="M 140 600 L 140 450" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 140 600 L 140 450" stroke="#f472b6" stroke-width="3" fill="none" marker-end="url(#arrowPink)" opacity="0.8"/>

      {/* Issuers -> Green Wallet */}
      <path d="M 230 390 L 440 390" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 230 390 L 440 390" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowBlue)" opacity="0.8"/>

      {/* Green Wallet -> Blockchain Core */}
      <path d="M 560 390 L 700 455" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 560 390 L 700 455" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowBlue)" opacity="0.8"/>

      {/* Red Wallet -> Blockchain Core */}
      <path d="M 560 600 L 700 525" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 560 600 L 700 525" stroke="#ef4444" stroke-width="3" fill="none" marker-end="url(#arrowRed)" opacity="0.8"/>

      {/* Oracles -> Blockchain Core */}
      <path d="M 1000 280 Q 860 280 790 440" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 1000 280 Q 860 280 790 440" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#arrowPurple)" opacity="0.8"/>

      {/* Blockchain Core -> Institutions */}
      <path d="M 810 520 Q 930 600 1000 600" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 810 520 Q 930 600 1000 600" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowBlue)" opacity="0.8"/>


      {/* ================= PARTICELLE ================= */}
      <circle r="7" fill="#34d399" filter="url(#glowSubtle)">
        <animateMotion dur="2.5s" repeatCount="indefinite" path="M 140 300 L 140 200" />
      </circle>
      <circle r="7" fill="#f472b6" filter="url(#glowSubtle)">
        <animateMotion dur="3s" repeatCount="indefinite" path="M 140 600 L 140 450" />
      </circle>
      <circle r="7" fill="#60a5fa" filter="url(#glowSubtle)">
        <animateMotion dur="2.5s" repeatCount="indefinite" path="M 230 390 L 440 390" />
      </circle>
      <circle r="7" fill="#60a5fa" filter="url(#glowSubtle)">
        <animateMotion dur="2s" repeatCount="indefinite" path="M 560 390 L 700 455" />
      </circle>
      <circle r="7" fill="#ef4444" filter="url(#glowSubtle)">
        <animateMotion dur="2.5s" repeatCount="indefinite" path="M 560 600 L 700 525" />
      </circle>


      {/* ================= BOX INFORMATIVI (HUD) INGRANDITI ================= */}
      
      {/* Custodian Box */}
      <foreignObject x="210" y="240" width="220" height="90" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/90 border border-emerald-500/50 rounded-2xl px-4 py-3 shadow-lg backdrop-blur-md">
          <span class="text-slate-200 text-xl font-semibold leading-tight text-center">Custodian<br/>authorizes mint</span>
          <span class="text-emerald-400 font-black text-xl text-center mt-1">1:1 Backed</span>
        </div>
      </foreignObject>

      {/* Mint Box */}
      <foreignObject x="160" y="460" width="180" height="80" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/90 border border-slate-600 rounded-xl px-3 py-2 shadow-lg backdrop-blur-md text-center">
          <span class="text-slate-300 text-x font-semibold leading-snug">Purchase shares<br/><span class="text-pink-400 font-bold">Asks for minting</span></span>
        </div>
      </foreignObject>

      {/* KYC Box */}
      <foreignObject x="210" y="650" width="140" height="70" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/90 border border-slate-600 rounded-xl px-3 py-2 shadow-lg backdrop-blur-md text-center">
          <span class="text-slate-300 text-xl font-semibold leading-snug">KYC / AML<br/>Fiat Transfer</span>
        </div>
      </foreignObject>

      {/* Institutions Box */}
      <foreignObject x="930" y="630" width="220" height="70" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/90 border border-blue-500/50 rounded-xl px-3 py-2 shadow-lg backdrop-blur-md text-center">
          <span class="text-blue-200 text-xl font-semibold leading-snug">All institutions look<br/>at the same truth</span>
        </div>
      </foreignObject>


      {/* ================= NODI PRINCIPALI ================= */}
      
      {/* 1. Custodian */}
      <g transform="translate(95, 110)">
        <g class="node-float">
          <text x="45" y="-25" text-anchor="middle" fill="#34d399" font-size="26" class="tech-font font-bold drop-shadow-md">Custodian</text>
          <polygon points="45,0 0,30 90,30" fill="#1e293b" stroke="#cbd5e1" stroke-width="4" stroke-linejoin="round"/>
          <rect x="10" y="30" width="12" height="40" fill="none" stroke="#cbd5e1" stroke-width="4"/>
          <rect x="39" y="30" width="12" height="40" fill="none" stroke="#cbd5e1" stroke-width="4"/>
          <rect x="68" y="30" width="12" height="40" fill="none" stroke="#cbd5e1" stroke-width="4"/>
          <rect x="0" y="70" width="90" height="12" fill="#1e293b" stroke="#cbd5e1" stroke-width="4"/>
          <circle cx="45" cy="50" r="5" fill="#10b981"/>
        </g>
      </g>

      {/* 2. Issuers */}
      <g transform="translate(100, 350)">
        <g class="node-float-delay">
          <text x="40" y="-20" text-anchor="middle" fill="#e2e8f0" font-size="28" class="tech-font font-bold drop-shadow-md">Issuers</text>
          <rect x="0" y="0" width="80" height="70" rx="10" fill="#1e293b" stroke="#cbd5e1" stroke-width="4"/>
          <rect x="15" y="15" width="20" height="20" fill="#334155"/>
          <rect x="45" y="15" width="20" height="20" fill="#334155"/>
          <rect x="15" y="45" width="50" height="15" fill="#334155"/>
          <circle cx="40" cy="-5" r="10" fill="#1e293b" stroke="#cbd5e1" stroke-width="4"/>
        </g>
      </g>

      {/* 3. Investor */}
      <g transform="translate(100, 680)">
        <g class="node-float">
          <text x="40" y="-20" text-anchor="middle" fill="#f472b6" font-size="28" class="tech-font font-bold drop-shadow-md">Investor</text>
          <circle cx="40" cy="20" r="18" fill="none" stroke="#f472b6" stroke-width="4"/>
          <path d="M 5 70 C 5 45 75 45 75 70" fill="none" stroke="#f472b6" stroke-width="4" stroke-linecap="round"/>
          <circle cx="65" cy="60" r="14" fill="#1e293b" stroke="#f472b6" stroke-width="3"/>
          <path d="M 59 60 L 63 64 L 72 54" fill="none" stroke="#f472b6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </g>
      </g>

      {/* 4. Green Wallet */}
      <g transform="translate(450, 350)">
        <g class="node-float">
          <text x="50" y="-20" text-anchor="middle" fill="#60a5fa" font-size="24" class="tech-font font-bold"><tspan x="50" dy="-20">Investor</tspan>           <tspan x="45" dy="25">Wallet</tspan>
          </text></text>
          <rect x="15" y="0" width="70" height="50" rx="8" fill="#1e293b" stroke="#60a5fa" stroke-width="4"/>
          <path d="M 15 15 L 85 15" stroke="#60a5fa" stroke-width="3"/>
          <circle cx="50" cy="32" r="6" fill="#60a5fa"/>
        </g>
      </g>

      {/* 5. Red Wallet */}
      <g transform="translate(450, 560)">
        <g class="node-float-delay">
          <text x="50" y="-20" text-anchor="middle" fill="#ef4444" font-size="24" class="tech-font font-bold">Other Wallets</text>
          <rect x="15" y="0" width="70" height="50" rx="8" fill="#1e293b" stroke="#ef4444" stroke-width="4"/>
          <path d="M 15 15 L 85 15" stroke="#ef4444" stroke-width="3"/>
          <circle cx="50" cy="32" r="6" fill="#ef4444"/>
        </g>
      </g>

      {/* 6. Blockchain Core */}
      <g transform="translate(760, 500)">
        <circle cx="0" cy="0" r="50" fill="#1e293b" stroke="#6366f1" stroke-width="3" filter="url(#glowHeavy)"/>
        <circle cx="0" cy="0" r="45" fill="none" stroke="#3b82f6" stroke-width="5" opacity="0.5">
          <animate style="animation: pulseCore 3s infinite" />
        </circle>
        
        {/* Core Icon */}
        <path d="M -20 -15 L 0 -30 L 20 -15 L 20 15 L 0 30 L -20 15 Z" fill="#0f172a" stroke="#60a5fa" stroke-width="3">
          <animate attributeName="opacity" values="1;0;1" dur="3s" repeatCount="indefinite"/>
        </path>
        <circle cx="0" cy="0" r="9" fill="#60a5fa">
          <animate attributeName="opacity" values="1;0;1" dur="1.5s" repeatCount="indefinite"/>
        </circle>
        <line x1="0" y1="0" x2="-20" y2="-15" stroke="#60a5fa" stroke-width="2"/>
        <line x1="0" y1="0" x2="20" y2="-15" stroke="#60a5fa" stroke-width="2"/>
        <line x1="0" y1="0" x2="0" y2="30" stroke="#60a5fa" stroke-width="2"/>
        
        <text x="0" y="75" text-anchor="middle" fill="#e2e8f0" font-size="28" class="tech-font font-extrabold" filter="url(#glowHeavy)">Blockchain Core</text>
      </g>

      {/* 7. Oracles */}
      <g transform="translate(1020, 220)">
        <g class="node-float">
          <text x="45" y="-20" text-anchor="middle" fill="#a78bfa" font-size="28" class="tech-font font-bold drop-shadow-md">Oracles</text>
          <polygon points="45,0 90,40 45,80 0,40" fill="#1e293b" stroke="#a78bfa" stroke-width="4"/>
          <polygon points="45,20 65,40 45,60 25,40" fill="#8b5cf6" stroke="none" opacity="0.8">
            <animate attributeName="opacity" values="0.8;0.3;0.8" dur="2s" repeatCount="indefinite"/>
          </polygon>
        </g>
      </g>

      {/* 8. Institutions / Clearing House */}
      <g transform="translate(1010, 560)">
        <g class="node-float-delay">
          <text x="50" y="-20" text-anchor="middle" fill="#60a5fa" font-size="28" class="tech-font font-bold drop-shadow-md">Institutions</text>
          <rect x="10" y="0" width="80" height="60" rx="6" fill="#1e293b" stroke="#60a5fa" stroke-width="4"/>
          <path d="M 25 25 L 40 25 M 60 25 L 75 25" stroke="#60a5fa" stroke-width="3" stroke-linecap="round"/>
          <circle cx="50" cy="25" r="8" fill="none" stroke="#60a5fa" stroke-width="3"/>
          <path d="M 25 50 L 75 50" stroke="#3b82f6" stroke-width="4" stroke-linecap="round"/>
          <circle cx="35" cy="50" r="3" fill="#0f172a"/>
          <circle cx="50" cy="50" r="3" fill="#0f172a"/>
          <circle cx="65" cy="50" r="3" fill="#0f172a"/>
        </g>
      </g>

    </svg>
  </div>
</div>

<style>
  /* Movimento della griglia di sfondo */
  @keyframes panGrid {
    0% { background-position: 0 0; }
    100% { background-position: 30px 30px; }
  }

  /* Effetto galleggiamento per i nodi */
  .node-float { animation: floatNode 6s ease-in-out infinite; }
  .node-float-delay { animation: floatNode 6s ease-in-out infinite 3s; }
  @keyframes floatNode {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
</style>