---
// FundDiagramAnimated.astro
---

<div class="w-full max-w-5xl mx-auto border border-slate-700 shadow-2xl rounded-2xl overflow-hidden custom-font bg-slate-900">
  {/* Import Google Font */}
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap');
    .custom-font { font-family: 'Space Grotesk', sans-serif; }
  </style>

  {/* Contenitore Principale */}
  <div class="relative w-full aspect-[16/10] text-slate-100 overflow-hidden z-0 font-sans">
    
    {/* --- BACKGROUND EFFECTS --- */}
    <div class="absolute inset-0 z-[-3] opacity-30" style="background-image: radial-gradient(#334155 1px, transparent 1px); background-size: 24px 24px;"></div>
    
    {/* Glow On-Chain (Top) */}
    <div class="absolute top-[-20%] left-[20%] w-[60%] h-[50%] bg-orange-600/10 rounded-full mix-blend-screen filter blur-[100px] animate-pulse-slow"></div>
    {/* Glow Off-Chain (Bottom) */}
    <div class="absolute bottom-[-20%] left-[20%] w-[60%] h-[50%] bg-blue-600/10 rounded-full mix-blend-screen filter blur-[100px] animate-pulse-slow" style="animation-delay: 2s;"></div>

    {/* --- ZONE DIVIDERS --- */}
    <div class="absolute top-[8%] left-[4%] right-[4%] bottom-[52%] border-2 border-dashed border-orange-500/30 rounded-t-xl bg-gradient-to-b from-orange-500/5 to-transparent z-[-1]">
      <span class="absolute top-2 left-4 text-orange-400/80 font-bold uppercase tracking-widest text-xs md:text-sm flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
        On-chain
      </span>
    </div>

    <div class="absolute top-[52%] left-[4%] right-[4%] bottom-[4%] border-2 border-dashed border-blue-500/30 rounded-b-xl bg-gradient-to-t from-blue-500/5 to-transparent z-[-1]">
      <span class="absolute bottom-2 left-4 text-blue-400/80 font-bold uppercase tracking-widest text-xs md:text-sm flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
        Off-chain
      </span>
    </div>

    {/* Center Red Badge (T+1) */}
    <div class="absolute top-[50%] left-[50%] -translate-x-1/2 -translate-y-1/2 z-40 bg-red-600/90 text-white font-bold px-6 py-2 rounded-full text-sm md:text-base border border-red-400 shadow-[0_0_25px_rgba(220,38,38,0.6)] backdrop-blur-sm animate-pulse-fast">
      This is a T+1 process.
    </div>

    {/* =========================================
        SVG LAYER (Enhanced Connections)
        ========================================= */}
    <svg class="absolute inset-0 w-full h-full z-0 pointer-events-none drop-shadow-lg" viewBox="0 0 1000 600" preserveAspectRatio="none">
      <defs>
        <marker id="arrow-orange" markerWidth="5" markerHeight="5" refX="4" refY="2.5" orient="auto">
          <path d="M0,0 L0,5 L5,2.5 z" fill="#f97316" />
        </marker>
        <marker id="arrow-blue" markerWidth="5" markerHeight="5" refX="4" refY="2.5" orient="auto">
          <path d="M0,0 L0,5 L5,2.5 z" fill="#3b82f6" />
        </marker>
        <marker id="arrow-mixed" markerWidth="5" markerHeight="5" refX="4" refY="2.5" orient="auto">
          <path d="M0,0 L0,5 L5,2.5 z" fill="#8b5cf6" />
        </marker>
        
        {/* Gradients for cross-chain lines */}
        <linearGradient id="grad-b-o" x1="0%" y1="100%" x2="0%" y2="0%">
          <stop offset="0%" stop-color="#3b82f6" />
          <stop offset="100%" stop-color="#f97316" />
        </linearGradient>
        <linearGradient id="grad-o-b" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#f97316" />
          <stop offset="100%" stop-color="#3b82f6" />
        </linearGradient>
      </defs>

      {/* --- TRACKS (Background faint lines) --- */}
      <path d="M 150 450 L 150 210" class="flow-track" stroke="url(#grad-b-o)" />
      <path d="M 500 210 L 500 450" class="flow-track" stroke="url(#grad-o-b)" />
      
      <path d="M 180 180 L 470 180" class="flow-track orange-track" />
      <path d="M 530 180 L 820 180" class="flow-track orange-track" />
      
      <path d="M 180 480 L 470 480" class="flow-track blue-track" />
      <path d="M 530 480 L 820 480" class="flow-track blue-track" />
      
      <path d="M 850 450 L 850 210" class="flow-track mixed-track" />


      {/* --- DATA PACKETS (Animated dashed glowing lines) --- */}
      {/* Cross-chain lines */}
      <path d="M 150 450 L 150 210" class="data-stream delay-1" stroke="url(#grad-b-o)" marker-end="url(#arrow-orange)" />
      <path d="M 500 210 L 500 450" class="data-stream delay-4" stroke="url(#grad-o-b)" marker-end="url(#arrow-blue)" />

      {/* On-chain lines (Orange) */}
      <path d="M 180 180 L 470 180" class="data-stream orange-glow delay-2" marker-end="url(#arrow-orange)" />
      <path d="M 530 180 L 820 180" class="data-stream orange-glow delay-3" marker-end="url(#arrow-orange)" />

      {/* Off-chain lines (Blue) */}
      <path d="M 180 480 L 470 480" class="data-stream blue-glow delay-2" marker-end="url(#arrow-blue)" />
      <path d="M 530 480 L 820 480" class="data-stream blue-glow delay-5" marker-end="url(#arrow-blue)" />
      
      {/* Depo <-> Depo Sync line */}
      <path d="M 850 450 L 850 210" class="data-stream mixed-glow delay-6 sync-reverse" marker-end="url(#arrow-mixed)" marker-start="url(#arrow-mixed)"/>
    </svg>

    {/* =========================================
        MAIN NODES (PURE ICONS)
        ========================================= */}
    
    {/* 1. Distributor (D) - On Chain */}
    <div class="node absolute top-[30%] left-[15%] -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center text-orange-400 drop-shadow-[0_0_15px_rgba(249,115,22,0.8)] z-20">
      <svg class="w-10 h-10 md:w-14 md:h-14 mb-2 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
      <span class="font-bold text-sm md:text-base tracking-widest text-orange-100">Issuer</span>
    </div>

    {/* 2. Platform (TP) - On Chain */}
    <div class="node absolute top-[30%] left-[50%] -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center text-orange-400 drop-shadow-[0_0_15px_rgba(249,115,22,0.8)] z-20">
      
      <svg class="w-12 h-12 md:w-16 md:h-16 mb-2 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
        <line x1="8" y1="21" x2="16" y2="21"></line>
        <line x1="12" y1="17" x2="12" y2="21"></line>
        <path d="M6 8h.01"></path><path d="M10 8h.01"></path><path d="M14 8h.01"></path>
      </svg>
      <span class="font-bold text-lg md:text-xl tracking-widest text-orange-100">Platform</span>
    </div>

    {/* 3. Depo - On Chain */}
    <div class="node absolute top-[30%] left-[85%] -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center text-orange-400 drop-shadow-[0_0_15px_rgba(249,115,22,0.8)] z-20">
      <svg class="w-10 h-10 md:w-14 md:h-14 mb-2 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
      </svg>
      <span class="font-bold text-sm md:text-base tracking-widest text-orange-100">Custodian</span>
    </div>

    {/* 4. Investor (I) - Off Chain */}
    <div class="node absolute top-[80%] left-[15%] -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center text-blue-400 drop-shadow-[0_0_15px_rgba(59,130,246,0.8)] z-20">
      <svg class="w-10 h-10 md:w-14 md:h-14 mb-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span class="font-bold text-sm md:text-base tracking-widest text-blue-100">Investor</span>
    </div>

    {/* 5. Depo - Off Chain */}
    <div class="node absolute top-[80%] left-[50%] -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center text-blue-400 drop-shadow-[0_0_15px_rgba(59,130,246,0.8)] z-20">
      <svg class="w-12 h-12 md:w-16 md:h-16 mb-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="4" y="10" width="16" height="12" rx="2" ry="2"></rect>
        <polygon points="12 2 20 10 4 10"></polygon>
        <line x1="12" y1="14" x2="12" y2="18"></line>
        <line x1="8" y1="14" x2="8" y2="18"></line>
        <line x1="16" y1="14" x2="16" y2="18"></line>
      </svg>
      <span class="font-bold text-sm md:text-base tracking-widest text-blue-100">Custodian</span>
    </div>

    {/* 6. Gestore / NAV - Off Chain */}
    <div class="node absolute top-[80%] left-[85%] -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center text-blue-400 drop-shadow-[0_0_15px_rgba(59,130,246,0.8)] z-20">
      <div class="absolute -left-6 top-1/2 -translate-y-1/2 bg-cyan-900/80 text-cyan-300 text-[10px] md:text-xs px-2 py-0.5 rounded border border-cyan-500 z-30 shadow-[0_0_10px_rgba(6,182,212,0.5)] backdrop-blur-sm">NAV</div>
      <svg class="w-10 h-10 md:w-14 md:h-14 mb-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
      </svg>
      <span class="font-bold text-sm md:text-base tracking-widest text-blue-100">NAV Setter</span>
    </div>


    {/* =========================================
        LIST ITEMS AS FLOATING DATA CHIPS
        ========================================= */}
    
    <div class="feature-chip border-orange-500/50 bg-orange-950/80 text-orange-200 absolute top-[16%] left-[32%] -translate-x-1/2 delay-1">
      <div class="dot bg-orange-500"></div> Order Validation <span class="text-[7px] text-orange-400/80">(min/max)</span>
    </div>
    <div class="feature-chip border-orange-500/50 bg-orange-950/80 text-orange-200 absolute top-[40%] left-[32%] -translate-x-1/2 delay-2">
      <div class="dot bg-orange-500"></div> Workflow Logic
    </div>
    <div class="feature-chip border-orange-500/50 bg-orange-950/80 text-orange-200 absolute top-[16%] left-[68%] -translate-x-1/2 delay-3">
      <div class="dot bg-orange-500"></div> Transfer Agency Rules
    </div>
    <div class="feature-chip border-orange-500/50 bg-orange-950/80 text-orange-200 absolute top-[40%] left-[68%] -translate-x-1/2 delay-4">
      <div class="dot bg-orange-500"></div> Fee Logic
    </div>
    <div class="feature-chip border-orange-500/50 bg-orange-950/80 text-orange-200 absolute top-[15%] left-[90%] -translate-x-1/2 delay-5">
      <div class="dot bg-orange-400 shadow-[0_0_8px_#fb923c]"></div> On-Chain Registry
    </div>

    <div class="feature-chip border-blue-500/50 bg-blue-950/80 text-blue-200 absolute top-[65%] left-[23%] -translate-x-1/2 delay-2">
      <div class="dot bg-blue-500"></div> KYC/AML
    </div>
    <div class="feature-chip border-blue-500/50 bg-blue-950/80 text-blue-200 absolute top-[90%] left-[32%] -translate-x-1/2 delay-3">
      <div class="dot bg-blue-500"></div> Cash Movements
    </div>
    <div class="feature-chip border-blue-500/50 bg-blue-950/80 text-blue-200 absolute top-[62%] left-[45%] -translate-x-1/2 delay-4">
      <div class="dot bg-blue-500"></div> Controls
    </div>
    <div class="feature-chip border-blue-500/50 bg-blue-950/80 text-blue-200 absolute top-[65%] left-[68%] -translate-x-1/2 delay-5">
      <div class="dot bg-blue-500"></div> Custodian Oversight
    </div>
    <div class="feature-chip border-cyan-500/50 bg-cyan-950/80 text-cyan-200 absolute top-[90%] left-[68%] -translate-x-1/2 delay-6">
      <div class="dot bg-cyan-400 shadow-[0_0_8px_#22d3ee]"></div> NAV Calculation
    </div>

  </div>
</div>

<style>
  /* --- New Arrow Animations --- */
  
  /* The subtle background track */
  .flow-track {
    fill: none;
    stroke-width: 2;
    opacity: 0.15;
    stroke-linecap: round;
  }
  .orange-track { stroke: #f97316; }
  .blue-track { stroke: #3b82f6; }
  .mixed-track { stroke: #8b5cf6; }

  /* The bright animated data stream */
  .data-stream {
    fill: none;
    stroke-width: 3;
    stroke-dasharray: 12 24; /* Creates 'packets' of data */
    stroke-linecap: round;
    animation: streamFlow 3s linear infinite;
  }
  
  .orange-glow { stroke: #fb923c; filter: drop-shadow(0 0 4px #fb923c); }
  .blue-glow { stroke: #60a5fa; filter: drop-shadow(0 0 4px #60a5fa); }
  .mixed-glow { stroke: #a78bfa; filter: drop-shadow(0 0 4px #a78bfa); }

  @keyframes streamFlow {
    from { stroke-dashoffset: 72; } /* Multiple of dasharray sum (12+24=36) */
    to { stroke-dashoffset: 0; }
  }

  /* Sync line goes both ways visually */
  .sync-reverse {
    stroke-dasharray: 8 16;
    animation: streamFlowReverse 4s linear infinite;
  }
  @keyframes streamFlowReverse {
    from { stroke-dashoffset: 0; }
    to { stroke-dashoffset: 48; }
  }

  /* --- Node Interactions --- */
  .node {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    animation: fadeInNode 0.8s ease-out backwards;
  }
  .node:hover {
    transform: translate(-50%, -55%) scale(1.15);
    z-index: 50;
    cursor: pointer;
    filter: brightness(1.2);
  }

  /* --- Feature Chips --- */
  .feature-chip {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 9999px;
    border-width: 1px;
    font-size: 9px;
    line-height: 1.1;
    font-weight: 500;
    backdrop-filter: blur(4px);
    white-space: nowrap;
    animation: floatChip 4s ease-in-out infinite, fadeInScale 0.6s ease-out backwards;
    z-index: 30;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
  }
  
  @media (min-width: 768px) {
    .feature-chip { font-size: 11px; padding: 6px 14px; gap: 8px; }
  }

  .feature-chip:hover {
    transform: translateX(-50%) scale(1.05);
    z-index: 50;
    border-color: white;
  }

  .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* --- Keyframes & Delays --- */
  @keyframes floatChip {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(-5px); }
  }

  @keyframes fadeInNode {
    from { opacity: 0; transform: translate(-50%, -30%) scale(0.9); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }

  @keyframes fadeInScale {
    from { opacity: 0; transform: translateX(-50%) scale(0.8); }
    to { opacity: 1; transform: translateX(-50%) scale(1); }
  }

  .animate-pulse-slow { animation: pulseBg 6s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
  .animate-pulse-fast { animation: pulseRed 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

  @keyframes pulseBg {
    0%, 100% { opacity: 0.1; transform: scale(1); }
    50% { opacity: 0.2; transform: scale(1.05); }
  }
  
  @keyframes pulseRed {
    0%, 100% { box-shadow: 0 0 20px rgba(220,38,38,0.4); }
    50% { box-shadow: 0 0 35px rgba(220,38,38,0.8); }
  }

  /* Delays */
  .delay-1 { animation-delay: 0.1s; }
  .delay-2 { animation-delay: 0.3s; }
  .delay-3 { animation-delay: 0.5s; }
  .delay-4 { animation-delay: 0.7s; }
  .delay-5 { animation-delay: 0.9s; }
  .delay-6 { animation-delay: 1.1s; }
</style>