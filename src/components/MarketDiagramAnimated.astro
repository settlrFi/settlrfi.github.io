---
// MarketDiagramAnimatedLarge.astro
---

<div class="relative w-full max-w-5xl mx-auto rounded-3xl overflow-hidden border border-indigo-500/30 shadow-[0_0_50px_rgba(79,70,229,0.15)] bg-gradient-to-br from-slate-950 via-indigo-950/80 to-slate-900 group">
  
  {/* Sfondo Griglia */}
  <div class="absolute inset-0 z-0 opacity-20 pointer-events-none" style="background-image: radial-gradient(#6366f1 1px, transparent 1px); background-size: 30px 30px; animation: panGrid 20s linear infinite;"></div>

  {/* Contenitore SVG - ViewBox Ingrandita */}
  <div class="relative z-10 w-full aspect-[16/11] min-h-[600px]">
    <svg viewBox="0 0 1200 850" class="w-full h-full drop-shadow-2xl" preserveAspectRatio="xMidYMid meet">
      
      <defs>
        <style>
          @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700;800&display=swap');
          .tech-font { font-family: 'Space Grotesk', system-ui, sans-serif; }
          
          /* Animazioni per la piattaforma */
          @keyframes dashMove { to { stroke-dashoffset: -20; } }
          .animated-path { stroke-dasharray: 8 6; animation: dashMove 1s linear infinite; }
        </style>

        <marker id="arrowGreen" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#34d399" />
        </marker>

        <marker id="arrowBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#60a5fa" />
        </marker>
        <marker id="arrowPurple" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#a78bfa" />
        </marker>

        <filter id="glowHeavy" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="5" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      {/* TITOLI INGRANDITI */}
      <text x="50" y="80" fill="#e2e8f0" font-size="46" class="tech-font font-extrabold drop-shadow-lg">
        Market Model
      </text>
      <text x="50" y="120" fill="#94a3b8" font-size="22" class="tech-font font-medium">
        Tokenized execution & supervision stack
      </text>


      {/* ================= COLLEGAMENTI (PATHS) RICALCOLATI ================= */}
      
      {/* Da RWA a Platform */}
      <path d="M 980 180 Q 800 220 750 280" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 980 180 Q 800 220 750 280" stroke="#38bdf8" stroke-width="3" fill="none" marker-end="url(#arrowBlue)" opacity="0.6"/>

      {/* Da Investor a Platform */}
      <path d="M 180 600 Q 320 520 480 430" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 180 600 Q 320 520 480 430" stroke="#f472b6" stroke-width="3" fill="none" marker-end="url(#arrowPink)" opacity="0.6"/>

      {/* Da Maker a Platform */}
      <path d="M 750 580 Q 680 500 630 430" stroke="#475569" stroke-width="5" fill="none" class="animated-path"/>
      <path d="M 750 580 Q 680 500 630 430" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#arrowPurple)" opacity="0.6"/>

      {/* Tra Maker e Custodian (Linee orizzontali) */}
      <path d="M 850 610 L 1010 610" stroke="#8b5cf6" stroke-width="4" fill="none" marker-end="url(#arrowPurple)" stroke-dasharray="8 6">
        <animate attributeName="stroke-dashoffset" from="14" to="0" dur="0.6s" repeatCount="indefinite"/>
      </path>
      <path d="M 1010 640 L 850 640" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrowGreen)" stroke-dasharray="8 6">
        <animate attributeName="stroke-dashoffset" from="0" to="14" dur="0.6s" repeatCount="indefinite"/>
      </path>


      {/* ================= PARTICELLE ================= */}
      <circle r="8" fill="#38bdf8" filter="url(#glowHeavy)">
        <animateMotion dur="3s" repeatCount="indefinite" path="M 980 180 Q 800 220 750 280" />
      </circle>
      <circle r="8" fill="#f472b6" filter="url(#glowHeavy)">
        <animateMotion dur="3s" repeatCount="indefinite" path="M 180 600 Q 320 520 480 430" />
      </circle>
      <circle r="8" fill="#a78bfa" filter="url(#glowHeavy)">
        <animateMotion dur="2.5s" repeatCount="indefinite" path="M 750 580 Q 680 500 630 430" />
      </circle>


      {/* ================= CHIP HUD INGRANDITI ================= */}
      
      {/* 1. Oracle */}
      <foreignObject x="640" y="100" width="280" height="80" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex items-center bg-slate-900/90 border border-cyan-500/50 rounded-full px-4 py-2 shadow-lg backdrop-blur-md">
          <span class="bg-cyan-500 text-slate-950 font-black text-base rounded-full w-8 h-8 flex items-center justify-center mr-3 shrink-0">1</span>
          <span class="text-slate-200 text-xl font-semibold leading-tight">Assets listed &amp; Oracle fixes reference prices</span>
        </div>
      </foreignObject>

      {/* 2. MM requests */}
      <foreignObject x="800" y="450" width="230" height="60" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex items-center bg-slate-900/90 border border-purple-500/50 rounded-full px-4 py-2 shadow-lg backdrop-blur-md">
          <span class="bg-purple-500 text-slate-950 font-black text-base rounded-full w-8 h-8 flex items-center justify-center mr-3 shrink-0">2</span>
          <span class="text-slate-200 text-xl font-semibold leading-tight">Maker requests<br/>asset shares</span>
        </div>
      </foreignObject>

      {/* 3. MM quotes & liquidity */}
      <foreignObject x="460" y="540" width="250" height="90" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/90 border border-indigo-500/50 rounded-2xl px-4 py-3 shadow-lg backdrop-blur-md">
          <div class="flex items-center mb-2">
            <span class="bg-indigo-400 text-slate-950 font-black text-base rounded-full w-7 h-7 flex items-center justify-center mr-3 shrink-0">3</span>
            <span class="text-slate-200 text-xl font-bold">Maker quotes shares</span>
          </div>
        </div>
      </foreignObject>

      <foreignObject x="640" y="680" width="250" height="90" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex flex-col bg-slate-900/90 border border-yellow-500/50 rounded-2xl px-4 py-3 shadow-lg backdrop-blur-md">
          <div class="flex items-center mb-2">
            <span class="bg-yellow-400 text-slate-950 font-black text-base rounded-full w-7 h-7 flex items-center justify-center mr-3 shrink-0">5</span>
            <span class="text-slate-200 text-xl font-bold">Anyone can insert liquidity</span>
          </div>
          
        </div>
      </foreignObject>

      {/* 4. Stable Coin */}
      <foreignObject x="220" y="470" width="190" height="60" class="overflow-visible">
        <div xmlns="http://www.w3.org/1999/xhtml" class="tech-font flex items-center bg-slate-900/90 border border-pink-500/50 rounded-full px-4 py-2 shadow-lg backdrop-blur-md">
          <span class="bg-pink-500 text-slate-950 font-black text-base rounded-full w-8 h-8 flex items-center justify-center mr-3 shrink-0">4</span>
          <span class="text-slate-200 text-xl font-bold">Stable Coin</span>
        </div>
      </foreignObject>


      {/* ================= NODI INGRANDITI ================= */}
      
      {/* Real World Asset */}
      <g transform="translate(950, 80)">
        <g class="node-float">
          <text x="50" y="-25" text-anchor="middle" fill="#38bdf8" font-size="26" class="tech-font font-bold drop-shadow-md">Real World Asset</text>
          <rect x="15" y="0" width="70" height="80" rx="6" fill="#1e293b" stroke="#38bdf8" stroke-width="4"/>
          <line x1="15" y1="25" x2="85" y2="25" stroke="#38bdf8" stroke-width="3"/>
          <line x1="15" y1="50" x2="85" y2="50" stroke="#38bdf8" stroke-width="3"/>
          <circle cx="85" cy="80" r="22" fill="#0f172a" stroke="#10b981" stroke-width="4"/>
          <path d="M 71 80 Q 85 95 99 80" fill="none" stroke="#10b981" stroke-width="3"/>
          <line x1="85" y1="58" x2="85" y2="102" stroke="#10b981" stroke-width="3"/>
        </g>
      </g>

      {/* T+0 Trading Platform */}
      <g transform="translate(490, 280)">
        <g class="node-float-delay">
          <text x="110" y="-25" text-anchor="middle" fill="#e2e8f0" font-size="30" class="tech-font font-extrabold" filter="url(#glowHeavy)">T+0 Trading Platform</text>
          
          <rect x="0" y="0" width="220" height="150" rx="16" fill="#0f172a" stroke="#6366f1" stroke-width="4" filter="drop-shadow(0 15px 20px rgba(99,102,241,0.3))"/>
          
          {/* Top Bar Server */}
          <rect x="0" y="0" width="220" height="30" rx="16" fill="#1e293b"/>
          <rect x="0" y="15" width="220" height="15" fill="#1e293b"/>
          <circle cx="20" cy="15" r="5" fill="#ef4444"/>
          <circle cx="40" cy="15" r="5" fill="#eab308"/>
          <circle cx="60" cy="15" r="5" fill="#22c55e"/>
          
          <text x="200" y="20" text-anchor="end" fill="#ef4444" font-size="14" class="tech-font font-bold">
            <animate attributeName="opacity" values="1;0.2;1" dur="1.5s" repeatCount="indefinite"/>
            LIVE
          </text>

          {/* Grafici Animati Interni */}
          <g transform="translate(15, 45)">
            <rect x="0" y="0" width="80" height="8" rx="4" fill="#34d399">
              <animate attributeName="width" values="80;120;60;80" dur="3s" repeatCount="indefinite"/>
            </rect>
            <rect x="0" y="22" width="110" height="8" rx="4" fill="#34d399">
              <animate attributeName="width" values="110;70;140;110" dur="4s" repeatCount="indefinite"/>
            </rect>
            <rect x="0" y="44" width="60" height="8" rx="4" fill="#f43f5e">
              <animate attributeName="width" values="60;90;40;60" dur="2.5s" repeatCount="indefinite"/>
            </rect>
            <rect x="0" y="66" width="130" height="8" rx="4" fill="#f43f5e">
              <animate attributeName="width" values="130;80;150;130" dur="3.5s" repeatCount="indefinite"/>
            </rect>
          </g>

          {/* Linea tracciato */}
          <path d="M 110 120 L 140 85 L 170 105 L 200 55" fill="none" stroke="#60a5fa" stroke-width="3" stroke-linejoin="round">
            <animate attributeName="stroke-dasharray" values="0,150;150,0" dur="5s" repeatCount="indefinite"/>
          </path>
        </g>
      </g>

      {/* Whitelisted Investor */}
      <g transform="translate(100, 580)">
        <g class="node-float">
          <text x="40" y="-45" text-anchor="middle" fill="#f472b6" font-size="24" class="tech-font font-bold drop-shadow-md">
            <tspan x="40" dy="0">Whitelisted</tspan>
            <tspan x="40" dy="28">Investor</tspan>
          </text>
          <circle cx="40" cy="20" r="18" fill="none" stroke="#f472b6" stroke-width="4"/>
          <path d="M 10 70 C 10 45 70 45 70 70" fill="none" stroke="#f472b6" stroke-width="4" stroke-linecap="round"/>
          <circle cx="74" cy="70" r="15" fill="#1e293b" stroke="#f472b6" stroke-width="3"/>
          <path d="M 66 70 L 73 77 L 82 62" fill="none" stroke="#f472b6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </g>
      </g>

      {/* Maker */}
      <g transform="translate(730, 580)">
        <g class="node-float-delay">
          <text x="40" y="-25" text-anchor="middle" fill="#a78bfa" font-size="26" class="tech-font font-bold drop-shadow-md">Maker</text>
          <circle cx="40" cy="20" r="18" fill="none" stroke="#cbd5e1" stroke-width="4"/>
          <path d="M 10 70 C 10 45 70 45 70 70" fill="none" stroke="#cbd5e1" stroke-width="4" stroke-linecap="round"/>
          <circle cx="75" cy="65" r="14" fill="#1e293b" stroke="#a78bfa" stroke-width="3"/>
          <path d="M 75 57 L 75 73 M 67 65 L 83 65 M 69 59 L 81 71 M 69 71 L 81 59" stroke="#a78bfa" stroke-width="3" stroke-linecap="round"/>
        </g>
      </g>

      {/* Custodian */}
      <g transform="translate(1050, 580)">
        <g class="node-float">
          <text x="45" y="-25" text-anchor="middle" fill="#34d399" font-size="26" class="tech-font font-bold drop-shadow-md">Custodian</text>
          <polygon points="45,0 0,30 90,30" fill="#1e293b" stroke="#cbd5e1" stroke-width="4" stroke-linejoin="round"/>
          <rect x="10" y="30" width="12" height="40" fill="none" stroke="#cbd5e1" stroke-width="4"/>
          <rect x="39" y="30" width="12" height="40" fill="none" stroke="#cbd5e1" stroke-width="4"/>
          <rect x="68" y="30" width="12" height="40" fill="none" stroke="#cbd5e1" stroke-width="4"/>
          <rect x="0" y="70" width="90" height="12" fill="#1e293b" stroke="#cbd5e1" stroke-width="4"/>
          <circle cx="45" cy="50" r="5" fill="#10b981"/>
        </g>
      </g>

    </svg>
  </div>
</div>

<style>
  /* Movimento della griglia di sfondo */
  @keyframes panGrid {
    0% { background-position: 0 0; }
    100% { background-position: 30px 30px; }
  }

  /* Effetto galleggiamento */
  .node-float { animation: floatNode 6s ease-in-out infinite; }
  .node-float-delay { animation: floatNode 6s ease-in-out infinite 3s; }
  @keyframes floatNode {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
</style>